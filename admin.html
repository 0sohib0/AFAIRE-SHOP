<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOHIB&HAMZA | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <link rel="stylesheet" href="admin.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <header>
        <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… SOHIB&HAMZA</h1>
        <div id="auth-controls">
            <button id="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <button id="logout-btn" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>

    <main id="admin-dashboard" style="display: none;">
        
        <nav class="tabs">
            <button class="tab-btn active" data-tab="orders-tab">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
            <button class="tab-btn" data-tab="products-tab">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
            <button class="tab-btn" data-tab="stats-tab">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø¯Ø§Ø®Ù„</button>
        </nav>

        <div id="orders-tab" class="tab-content active">
            <h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ‚ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h2>
            <div class="stats-bar">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: <strong id="total-orders">0</strong></span>
                <span>Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©: <strong id="new-orders">0</strong></span>
            </div>
            <table id="orders-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                        <th>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</th>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø°Ø§Ø¡</th> 
                        <th> Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø§Ùˆ Ù…ÙƒØªØ¨ Ø§Ù„ØªÙˆØµÙŠÙ„</th>
                        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <p id="loading-message">Ø¬Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
        </div>
        
        <div id="products-tab" class="tab-content">
            <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
            <form id="product-form" class="form-grid">
                
                <label for="product-name">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
                <input type="text" id="product-name" required>

                <label for="product-id">Product ID (Ù…Ø«Ø§Ù„: new-mug):</label>
                <input type="text" id="product-id" required>

                <label for="product-price">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ (DZD):</label>
                <input type="number" id="product-price" min="1" required>
                
                <label for="product-discount">Ø³Ø¹Ø± Ø§Ù„ØªØ®ÙÙŠØ¶ (DZD - Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="number" id="product-discount" min="0" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ØªØ®ÙÙŠØ¶">
                
                <label for="product-img">Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø«Ø§Ù„: img/new-mug.jpg):</label>
                <input type="text" id="product-img" required>
                
                <label for="product-inventory">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„ÙƒÙ„ Ø±Ù‚Ù… Ø­Ø°Ø§Ø¡ (JSON):</label>
                <textarea id="product-inventory" rows="4" placeholder='Ù…Ø«Ø§Ù„: {"37": 10, "38": 5, "39": 20}' required></textarea>

                <button type="submit" class="submit-btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
                <p id="product-status" style="margin-top: 10px;"></p>
            </form>

             <h3 style="margin-top: 30px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù„Ø¥Ø¯Ø§Ø±ØªÙ‡Ø§ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)</h3>
            <table id="products-list-table">
                <thead>
                    <tr>
                        <th>Product ID</th>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ</th>
                        <th>Ø³Ø¹Ø± Ø§Ù„ØªØ®ÙÙŠØ¶</th>
                        <th>ØµÙˆØ±Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
        
        <div id="stats-tab" class="tab-content">
            <h2>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø¯Ø§Ø®Ù„</h2>

            <div class="stats-bar details-bar">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: <strong id="expected-revenue">0 DZD</strong></span>
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© (ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„): <strong id="confirmed-revenue">0 DZD</strong></span>
                <span>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨: <strong id="avg-order-value">0 DZD</strong></span>
            </div>

            <p id="stats-message">Ø¬Ø§Ø±Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...</p>
        </div>
        
    </main>

    <div id="login-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„</h3>
            <form id="login-form">
                <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                <button type="submit" class="submit-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <p id="auth-error" style="color: red; margin-top: 10px;"></p>
            </form>
        </div>
    </div>

  <script>
        document.addEventListener('DOMContentLoaded', () => {

            const SUPABASE_URL = 'https://lpvrwuwzytuqvqlmsmpv.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwdnJ3dXd6eXR1cXZxbG1zbXB2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NDEzODQsImV4cCI6MjA3NTIxNzM4NH0.J_gc9Y1BwMOTZEhCzw8iyhZS7DcngYUVaHY859j5wnQ';
            
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY); 

            const elements = {
                loginModal: document.getElementById('login-modal'),
                loginForm: document.getElementById('login-form'),
                loginBtn: document.getElementById('login-btn'),
                logoutBtn: document.getElementById('logout-btn'),
                dashboard: document.getElementById('admin-dashboard'),
                ordersTableBody: document.querySelector('#orders-table tbody'),
                loadingMessage: document.getElementById('loading-message'),
                totalOrders: document.getElementById('total-orders'),
                newOrders: document.getElementById('new-orders'),
                authError: document.getElementById('auth-error'),

                productForm: document.getElementById('product-form'),
                productStatus: document.getElementById('product-status'),
                productsListTableBody: document.querySelector('#products-list-table tbody'),
                statsMessage: document.getElementById('stats-message'),
                expectedRevenue: document.getElementById('expected-revenue'),
                confirmedRevenue: document.getElementById('confirmed-revenue'),
                avgOrderValue: document.getElementById('avg-order-value'),

                tabBtns: document.querySelectorAll('.tab-btn'),
                tabContents: document.querySelectorAll('.tab-content')
            };

            const STATUSES = ['Ø¬Ø¯ÙŠØ¯', 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯', 'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†', 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„', 'Ù…Ù„ØºÙ‰'];
            let MOCK_PRODUCTS = {}; 

            // 0. ÙˆØ¸ÙŠÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª 
            elements.tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.getAttribute('data-tab');

                    elements.tabBtns.forEach(b => b.classList.remove('active'));
                    elements.tabContents.forEach(c => c.classList.remove('active'));
                    elements.tabContents.forEach(c => c.style.display = 'none');

                    btn.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                    document.getElementById(targetTab).style.display = 'block';

                    if (targetTab === 'orders-tab') loadOrders();
                    if (targetTab === 'stats-tab') calculateStats();
                    if (targetTab === 'products-tab') loadProductsList();
                });
            });

            // 1. ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            elements.loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                elements.authError.textContent = '';
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) {
                    elements.authError.textContent = `ÙØ´Ù„: ${error.message}`;
                } else {
                    elements.loginModal.style.display = 'none';
                    checkAuthStatus();
                }
            });

            // 2. ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            elements.logoutBtn.addEventListener('click', async () => {
                const { error } = await supabase.auth.signOut();
                if (!error) {
                    checkAuthStatus();
                }
            });

            // 3. Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            elements.loginBtn.addEventListener('click', () => {
                elements.loginModal.style.display = 'flex';
            });

            // 4. Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
            async function checkAuthStatus() {
                const { data: { session } } = await supabase.auth.getSession();
                if (session) {
                    elements.loginBtn.style.display = 'none';
                    elements.logoutBtn.style.display = 'block';
                    elements.dashboard.style.display = 'block';
                    elements.loginModal.style.display = 'none';
                    document.getElementById('orders-tab').style.display = 'block'; 
                    loadOrders();
                } else {
                    elements.loginBtn.style.display = 'block';
                    elements.logoutBtn.style.display = 'none';
                    elements.dashboard.style.display = 'none';
                    elements.ordersTableBody.innerHTML = '';
                    elements.loadingMessage.style.display = 'none';
                }
            }

            // 5. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Supabase 
            async function loadOrders() {
                elements.loadingMessage.style.display = 'block';
                // ğŸ”´ ØªÙ†Ø¨ÙŠÙ‡: ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø³ÙŠØ§Ø³Ø© SELECT Ù„Ø¬Ø¯ÙˆÙ„ orders Ù„Ù„Ø¯ÙˆØ± authenticated
                const { data, error } = await supabase
                    .from('orders')
                    .select('id, created_at, product_name, client_name, phone_number, wilaya, detailed_address, quantity, status, shoe_size') 
                    .order('created_at', { ascending: false });

                elements.loadingMessage.style.display = 'none';
                
                if (error) {
                    elements.ordersTableBody.innerHTML = `<tr><td colspan="10" style="color:red;">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</td></tr>`;
                    return;
                }
                renderOrders(data);
            }

            // 6. Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ 
            function renderOrders(orders) {
                elements.ordersTableBody.innerHTML = '';
                let newCount = 0;
                
                // ØªØ­Ø¯ÙŠØ« Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­)
                document.querySelector('#orders-table thead tr').innerHTML = `
                    <th>ID</th>
                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø°Ø§Ø¡</th> 
                    <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                `;
                
                orders.forEach(order => {
                    if (order.status === 'Ø¬Ø¯ÙŠØ¯') newCount++;
                    const row = elements.ordersTableBody.insertRow();
                    row.dataset.orderId = order.id;

                    row.insertCell().textContent = order.id;
                    row.insertCell().textContent = order.product_name;
                    row.insertCell().textContent = order.client_name;
                    row.insertCell().textContent = order.phone_number;
                    row.insertCell().textContent = order.wilaya;
                    row.insertCell().textContent = order.shoe_size || 'N/A'; // Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ø­Ø°Ø§Ø¡
                    row.insertCell().textContent = order.detailed_address || 'N/A';
                    row.insertCell().textContent = order.quantity;

                    const statusCell = row.insertCell();
                    statusCell.innerHTML = createStatusSelect(order.status, order.id);

                    const actionCell = row.insertCell();
                    const updateBtn = document.createElement('button');
                    updateBtn.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©';
                    updateBtn.className = 'status-update-btn';
                    updateBtn.addEventListener('click', () => updateOrderStatus(order.id));
                    actionCell.appendChild(updateBtn);
                });

                elements.totalOrders.textContent = orders.length;
                elements.newOrders.textContent = newCount;
            }

            // 7. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ø­Ø§Ù„Ø© (Ù„Ù… ØªØªØºÙŠØ±)
            function createStatusSelect(currentStatus, orderId) {
                let html = `<select class="status-select" data-order-id="${orderId}">`;
                STATUSES.forEach(status => {
                    const selected = status === currentStatus ? 'selected' : '';
                    html += `<option value="${status}" ${selected}>${status}</option>`;
                });
                html += '</select>';
                return html;
            }

            // 8. ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ (Ù„Ù… ØªØªØºÙŠØ±)
            async function updateOrderStatus(orderId) {
                const selectElement = document.querySelector(`.status-select[data-order-id="${orderId}"]`);
                const newStatus = selectElement.value;
                
                if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ${orderId} Ø¥Ù„Ù‰: ${newStatus}ØŸ`)) {
                    return;
                }

                // ğŸ”´ ØªÙ†Ø¨ÙŠÙ‡: ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø³ÙŠØ§Ø³Ø© UPDATE Ù„Ø¬Ø¯ÙˆÙ„ orders Ù„Ù„Ø¯ÙˆØ± authenticated
                const { error } = await supabase
                    .from('orders')
                    .update({ status: newStatus })
                    .eq('id', orderId);

                if (error) {
                    alert('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©: ' + error.message);
                } else {
                    alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                    loadOrders(); 
                    if (document.getElementById('stats-tab').classList.contains('active')) {
                        calculateStats(); 
                    }
                }
            }

            // 9. Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ (Ù…ÙØ­Ø¯Ù‘ÙØ« Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†)
            elements.productForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                elements.productStatus.textContent = '';
                
                const discountPriceValue = document.getElementById('product-discount').value;
                // ğŸ’¡ Ø¬Ù„Ø¨ Ù†Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù† Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const inventoryJsonString = document.getElementById('product-inventory').value;

                let inventoryObject;
                try {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù„ÙŠÙ„ (Parse) Ù†Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙƒÙƒØ§Ø¦Ù† JSON
                    inventoryObject = JSON.parse(inventoryJsonString);
                } catch (err) {
                    elements.productStatus.textContent = `âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬: ØµÙŠØºØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ØµØ­ÙŠØ­Ø© (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† JSON).`;
                    elements.productStatus.style.color = 'red';
                    return;
                }

                const product = {
                    product_id: document.getElementById('product-id').value,
                    name: document.getElementById('product-name').value,
                    price: parseFloat(document.getElementById('product-price').value),
                    discount_price: discountPriceValue ? parseFloat(discountPriceValue) : null,
                    img_path: document.getElementById('product-img').value,
                    // ğŸ’¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    inventory_json: inventoryObject 
                };

                // ğŸ”´ ØªÙ†Ø¨ÙŠÙ‡: ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø³ÙŠØ§Ø³Ø© INSERT Ù„Ø¬Ø¯ÙˆÙ„ products Ù„Ù„Ø¯ÙˆØ± authenticated
                const { error } = await supabase
                    .from('products') 
                    .insert([product]);

                if (error) {
                    elements.productStatus.textContent = `âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`;
                    elements.productStatus.style.color = 'red';
                } else {
                    elements.productStatus.textContent = 'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!';
                    elements.productStatus.style.color = 'green';
                    elements.productForm.reset();
                    loadProductsList();
                }
            });

            // 10. Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ù…ÙØ­Ø¯Ù‘ÙØ« Ù„Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ø§Ù„ØªØ®ÙÙŠØ¶)
            async function loadProductsList() {
                elements.productsListTableBody.innerHTML = '<tr><td colspan="5">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
                 // ğŸ”´ ØªÙ†Ø¨ÙŠÙ‡: ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø³ÙŠØ§Ø³Ø© SELECT Ù„Ø¬Ø¯ÙˆÙ„ products Ù„Ù„Ø¯ÙˆØ± authenticated
                const { data, error } = await supabase
                    .from('products') 
                    .select('*'); 

                if (error) {
                    elements.productsListTableBody.innerHTML = `<tr><td colspan="5" style="color:red;">Ø®Ø·Ø£: ${error.message}</td></tr>`;
                    return;
                }
                
                elements.productsListTableBody.innerHTML = '';
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                MOCK_PRODUCTS = {};
                
                data.forEach(p => {
                    MOCK_PRODUCTS[p.name] = p.discount_price || p.price;
                    
                    const row = elements.productsListTableBody.insertRow();
                    row.insertCell().textContent = p.product_id;
                    row.insertCell().textContent = p.name;
                    row.insertCell().textContent = p.price;
                    row.insertCell().textContent = p.discount_price ? p.discount_price : '---';
                    row.insertCell().textContent = p.img_path;
                });
            }


            // 11. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø¯Ø§Ø®Ù„ (ğŸ”´ ØªÙ… ØªØ¨Ø³ÙŠØ·Ù‡Ø§ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„ØµÙØ­Ø©)
            async function calculateStats() {
                 elements.statsMessage.style.display = 'block';
                 elements.statsMessage.textContent = 'ØªØ¹Ø°Ø± Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©: ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø³ÙŠØ§Ø³Ø© SELECT Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© ÙÙŠ Supabase.';
                 
                 // ØªØ¹Ø·ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
                 elements.expectedRevenue.textContent = `---`;
                 elements.confirmedRevenue.textContent = `---`;
                 elements.avgOrderValue.textContent = `---`;
            }

            checkAuthStatus();
        });
    </script>
</body>

</html>
